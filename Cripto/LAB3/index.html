<!DOCTYPE html>
<html>
<head>
    <title>Playfair Cipher</title>
</head>
<body>
    <h1>Playfair Cipher</h1>
    <label for="operation">Выберите операцию:</label>
    <select id="operation">
        <option value="encrypt">Зашифровать</option>
        <option value="decrypt">Расшифровать</option>
    </select>
    <br>
    <label for="key">Введите ключ (не менее 7 символов):</label>
    <input type="text" id="key" />
    <br>
    <label for="message">Введите сообщение:</label>
    <input type="text" id="message" />
    <br>
    <label for="language">Выберите язык сообщения:</label>
    <select id="language">
        <option value="english">Английский</option>
        <option value="romanian">Румынский</option>
    </select>
    <br>
    <button onclick="processPlayfair()">Выполнить</button>
    <br>
    <p>Результат:</p>
    <textarea id="output" rows="4" cols="50"></textarea>

    <script>
        function processPlayfair() {
            const operation = document.getElementById("operation").value;
            const key = document.getElementById("key").value;
            const message = document.getElementById("message").value;
            const language = document.getElementById("language").value;
            const result = playfairCipher(operation, key, message, language);
            document.getElementById("output").value = result;
        }

        function playfairCipher(operation, key, message, language) {
            if (key.length < 7) {
                return "Ключ должен содержать не менее 7 символов.";
            }

            const matrix = createPlayfairMatrix(key);

            let result = "";
            const sanitizedMessage = message.toUpperCase().replace(/[^A-Z]/g, "");
            const spaceCharacter = language === 'romanian' ? 'Ş' : 'X'; // Выбор разделителя в зависимости от языка

            function processBigram(bigram) {
                const [char1, char2] = bigram;

                const [row1, col1] = findPosition(matrix, char1);
                const [row2, col2] = findPosition(matrix, char2);

                if (row1 === row2) {
                    // Замена символов в одной строке
                    result += matrix[row1][(col1 + (operation === "encrypt" ? 1 : -1) + 5) % 5];
                    result += matrix[row2][(col2 + (operation === "encrypt" ? 1 : -1) + 5) % 5];
                } else if (col1 === col2) {
                    // Замена символов в одной колонке
                    result += matrix[(row1 + (operation === "encrypt" ? 1 : -1) + 5) % 5][col1];
                    result += matrix[(row2 + (operation === "encrypt" ? 1 : -1) + 5) % 5][col2];
                } else {
                    // Замена символов в разных строках и колонках
                    result += matrix[row1][col2];
                    result += matrix[row2][col1];
                }
            }

            for (let i = 0; i < sanitizedMessage.length; i += 2) {
                const bigram = sanitizedMessage.slice(i, i + 2);
                if (bigram.length === 2) {
                    if (bigram[0] === bigram[1]) {
                        bigram = bigram[0] + spaceCharacter + bigram[1];
                    }
                    processBigram(bigram);
                } else {
                    // Один символ (нечетная длина сообщения)
                    bigram = bigram[0] + spaceCharacter;
                    processBigram(bigram);
                }
            }

            return result;
        }

        function createPlayfairMatrix(key) {
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            key = key.toUpperCase().replace(/[^A-Z]/g, "");
            let matrix = [];

            for (let char of key) {
                if (!matrix.flat().includes(char)) {
                    matrix.push(char);
                }
            }

            for (let char of alphabet) {
                if (!matrix.flat().includes(char)) {
                    matrix.push(char);
                }
            }

            matrix = matrix.join("").match(/.{1,5}/g);

            return matrix;
        }

        function findPosition(matrix, char) {
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    if (matrix[row][col] === char) {
                        return [row, col];
                    }
                }
            }
        }
    </script>
</body>
</html>
